<!DOCTYPE html>
<html>
<head>
    <title>Recommended Videos</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <style>

        .video-container {
            position: relative;
            width: 920px;
            height: 520px;
            margin-left: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        /* Style for each video box */
        .video-box {
            margin: 10px;
            max-width: 300px;
            text-align: center;
            border: 1px solid #ccc;
            padding: 10px;
        }

        /* Style for video iframe */
        .video-box iframe {
            width: 100%; /* Make sure the iframe fits within the box */
            height: 200px; /* Set a fixed height for consistency */
            border: none; /* Remove border to avoid additional spacing */
        }

        /* Style for video title */
        .video-title {
            margin-top: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <h1>Videos</h1>
    <div class="video-container" id="video-container">
    </div>

    <h1>Recommended Videos</h1>
    <div class="video-container" id="recommended-videos-container">
        <!-- Recommended videos will be inserted here dynamically -->
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>

        // working fine
        function populateRecommendedVideos(recommendedVideos) {
            const recommendationsContainer = document.getElementById('recommended-videos-container');
            recommendationsContainer.innerHTML = ''; // Clear previous recommendations

            recommendedVideos.forEach(video => {
                const videoBox = document.createElement('div');
                videoBox.className = 'video-box';
                videoBox.innerHTML = `
                    <iframe src="${video.EmbedURL}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                    <div class="video-details">
                        <h2 class="video-title">${video.Title}</h2>
                    </div>
                `;
                recommendationsContainer.appendChild(videoBox);
            });
        }

        // Fetch recommended videos via AJAX when the page loads
        window.addEventListener('load', function () {
            // Extract video ID from the URL parameter
            const params = new URLSearchParams(window.location.search);
            const videoId = params.get('video_id');

            if (videoId) {
                // Fetch recommended videos via AJAX
                fetch('/get_recommendations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ category: videoId }) // Pass the video ID as category
                })
                .then(response => response.json())
                .then(data => populateRecommendedVideos(data))
                .catch(error => console.error('Error fetching recommended videos:', error));
            } else {
                console.error('No video ID found in URL parameter.');
            }
        });


                // Function to create a video player inside the specified element
                function createVideoPlayer(videoId) {
            var player = new YT.Player('video-container', {
                height: '300', // Set height to 480 pixels
                width: '50',  // Set width to 854 pixels
                videoId: videoId,
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            event.target.playVideo();
        }

        // The API calls this function when the player's state changes.
        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.ENDED) {
                // Video ended, you can perform additional actions here
            }
        }

        // Call the function to create the video player when the API is ready
        function onYouTubeIframeAPIReady() {
            // Extract video ID from the URL parameter
            const params = new URLSearchParams(window.location.search);
            const videoId = params.get('video_id');
            if (videoId) {
                createVideoPlayer(videoId);
            } else {
                console.error('No video ID found in URL parameter.');
            }
        }
    </script>
</body>
</html>
